extends baseLayout
 
block body
    #paste
        .paste-header
            .left
                -if(paste.title != "")
                    p.title= paste.title
                -else
                    p.title.untitled (untitled)

            .right
                -if(paste.ownerId != "" && session.user.id == paste.ownerId)
                    a.tooltip(href="/" ~ paste.id ~ "/edit")
                        i.fas.fa-edit
                        span.tooltip-text edit paste

                    form.set-public-on-profile-paste(method="post", action="/" ~ paste.id ~ "/togglePublicOnProfile")
                        -if (paste.isPublic)
                            button.public.tooltip(type="submit")
                                i.fas.fa-eye
                                span.tooltip-text set to private on profile
                        -else
                            button.private.tooltip(type="submit")
                                i.fas.fa-eye
                                span.tooltip-text set to public on profile

                    form.delete-paste(method="post", action="/" ~ paste.id ~ "/delete", onsubmit="return confirm('are you sure you want to delete this paste? you won\\'t be able to recover it.');")
                        button.tooltip(type="submit")
                            i.fas.fa-trash
                            span.tooltip-text delete paste
 
        .paste-pasties
            -import std.conv : to;
            -foreach(i, p; paste.pasties)
                .pasty
                    .pasty-header
                        -if(p.title != "")
                            p.title= p.title
                        -else
                            p.title.untitled (untitled)
                        span.lang= p.language
                        a.raw(href="/raw/" ~ paste.id ~ "/" ~ i.to!string()) raw
                    .pasty-content
                        textarea=p.code
 
        .paste-meta
            p.created-at
                span.highlight created at:
                span.value
            -import pastemyst.data : ExpiresIn;
            -if(paste.expiresIn != ExpiresIn.never)
                p.expires-in
                    span.highlight expires in:
                    span.value
            -if(paste.edits.length != 0)
                p.edited-at
                    span.highlight last edited at:
                    span.value
                p
                    span.highlight edits: 
                    span.value= paste.edits.length
 
block scripts
    script.
        var createdAt = #{paste.createdAt};
        var expiresIn = "#{cast(string) paste.expiresIn}";
        var deletesAt = #{paste.deletesAt};
        var isEdited = #{paste.edits.length != 0};
        var editedAt = 0;
        var langs = [];

    -foreach(p; paste.pasties)
        script.
            langs.push("#{p.language}");

    -if(paste.edits.length != 0)
        script.
            editedAt = #{paste.edits[$-1].editedAt};

    script(type="module", src="/static/scripts/pages/paste.js")
